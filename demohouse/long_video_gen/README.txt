# 长视频生成应用 - 完整使用指南

## 🎬 应用概述

这是一个基于方舟大模型的长视频生成Web应用，使用Streamlit构建。应用可以自动生成分镜、图片、音频、视频，并通过智能的音视频时长调整技术，将所有内容合成为完整的长视频。

## 📋 功能特性

### ✅ 核心功能
1. **分镜生成** - 使用豆包Seed1.6模型生成故事分镜
2. **分镜信息提取** - 自动解析JSON格式的分镜信息
3. **分镜图片生成** - 使用seedream模型生成场景图片
4. **视频Prompt生成** - 为每个场景生成视频提示词
5. **音频生成** - 使用方舟语音合成API生成旁白音频
6. **分镜视频生成** - 使用seedance模型生成视频 + 智能时长调整
7. **音视频合成** - 将视频和音频合成为有音频的视频
8. **视频拼接** - 拼接所有音视频为完整长视频
9. **清空数据** - 一键清空所有生成的文件和数据

### 🎯 智能时长调整
- **自动检测** - 自动检测音视频时长差异
- **速度调整** - 使用ffmpeg调整视频播放速度以匹配音频时长
- **精确匹配** - 支持0.1秒的误差容忍，避免不必要的调整
- **用户反馈** - 显示调整前后的时长变化信息

## 🚀 快速开始

### 1. 环境要求
- Python 3.8+
- macOS / Linux / Windows (推荐macOS)
- 稳定的网络连接
- ffmpeg 视频处理工具

### 2. 一键安装
```bash
# 克隆项目（如果尚未克隆）
cd /Users/bytedance/Desktop/HW/通用解决方案/demo搭建实验/

# 进入项目目录
cd 长视频生成

# 安装ffmpeg (macOS)
brew install ffmpeg

# 安装Python依赖
pip install -r requirements.txt -i https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple
```

### 3. 配置方舟API

编辑 `方舟模型配置.cfg` 文件，填入您的方舟平台API密钥：

```ini
[ark_config]
api_key = 您的api_key

[tts_config]
appid = 您的语音合成APPID
access_token = 您的语音合成ACCESS_TOKEN
secret_key = 您的语音合成secret_key
voice_type = 您的音色类型码（目前默认了一种）
（获取方式请参考https://www.volcengine.com/docs/6561/1257543）

[model_config]
seedance_model_id = seedance-1.6b
seedream_model_id = seedream-1.6b  
seed_model_id = seed-1.6b
```

### 4. 启动应用
```bash
streamlit run app_250911.py
```

### 5. 访问应用
打开浏览器访问：http://localhost:8501

## 📖 完整使用流程

### 第一步：输入场景需求
1. 在首页文本框中描述您想要的视频场景
2. 点击"分镜生成"按钮
3. 系统使用豆包Seed1.6模型生成故事分镜

### 第二步：分镜信息提取
1. 查看生成的分镜内容
2. 点击"提取分镜信息"按钮
3. 系统自动解析JSON格式的分镜信息

### 第三步：生成场景资源
1. **生成图片** - 为每个场景点击"生成分镜图片"
2. **生成视频Prompt** - 为每个场景点击"生成视频Prompt"  
3. **生成音频** - 为每个场景点击"生成音频"

### 第四步：生成视频并调整时长
1. 点击"生成分镜视频"按钮
2. 系统自动执行以下流程：
   - 使用seedance模型生成原始视频
   - 检测音视频时长差异
   - 使用ffmpeg调整视频速度以匹配音频时长
   - 显示调整结果信息

### 第五步：音视频合成
1. 为每个场景点击"音视频合成"
2. 系统将视频和音频合成为有音轨的视频

### 第六步：最终拼接
1. 点击"拼接视频"按钮
2. 系统将所有场景视频拼接为完整长视频
3. 下载最终的拼接视频

### 第七步：清理与重启
1. 点击"清空所有数据"开始新任务
2. 所有生成文件将被清除

## ⚙️ 技术架构

### 前端框架
- **Streamlit 1.36.0** - 现代化Web应用框架
- **响应式设计** - 支持桌面和移动设备

### AI模型集成
- **豆包Seed1.6** - 文本生成和分镜创作
- **seedream模型** - 图片生成
- **seedance模型** - 视频生成
- **方舟语音合成** - 高质量音频生成

### 视频处理
- **ffmpeg** - 业界标准视频处理工具
- **moviepy 2.0.0** - Python视频编辑库
- **智能时长调整** - 自动音视频同步

### 文件管理
- **结构化存储** - 按类型分类存储文件
- **持久化保存** - 生成文件自动保存
- **一键清理** - 快速清除所有数据

## 🛠️ 配置文件详解

### 主配置文件 `app_250911.py`
- 应用主逻辑和界面设计
- 包含所有功能函数的实现
- Streamlit界面组件配置

### 模型配置 `方舟模型配置.cfg`
- 方舟平台API密钥配置
- 各模型参数设置
- 语音合成参数配置

### 提示词模板
- `分镜生成Prompt.md` - 分镜生成提示词
- `分镜图片生成Prompt.md` - 图片生成提示词  
- `分镜生成视频Prompt的Prompt.md` - 视频提示词生成模板

## 📁 文件目录结构

```
长视频生成/
├── app_250911.py                 # 主应用文件
├── requirements.txt               # Python依赖列表
├── 方舟模型配置.cfg               # API密钥配置
├── README.txt                     # 本使用指南
├── 文件生成/                      # 自动生成的目录
│   ├── 分镜图片_1.jpg             # 生成的场景图片
│   ├── 分镜视频_1.mp4             # 生成的原始视频
│   ├── 分镜视频_1_adjusted.mp4    # 时长调整后的视频
│   ├── 分镜音频_1.wav             # 生成的音频文件
│   ├── 音视频_1.mp4               # 合成后的音视频
│   └── 拼接视频.mp4               # 最终的长视频
├── 分镜生成Prompt.md              # 分镜提示词模板
├── 分镜图片生成Prompt.md          # 图片提示词模板
└── 分镜生成视频Prompt的Prompt.md   # 视频提示词模板
```

## 🔧 故障排除指南

### 常见问题

1. **ffmpeg未找到错误**
   ```bash
   # 检查ffmpeg安装
   which ffmpeg
   # 如果未安装：
   brew install ffmpeg  # macOS
   sudo apt install ffmpeg  # Ubuntu/Debian
   ```

2. **方舟API连接失败**
   - 检查 `方舟模型配置.cfg` 文件中的密钥是否正确
   - 确认网络连接正常
   - 验证方舟平台账户状态

3. **依赖包安装失败**
   ```bash
   # 使用清华镜像源
   pip install -r requirements.txt -i https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple
   
   # 或者使用阿里云镜像
   pip install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple/
   ```

4. **内存不足问题**
   - 视频生成需要较大内存，建议16GB+ RAM
   - 可以分批处理场景，避免同时生成过多视频

5. **Streamlit启动问题**
   ```bash
   # 检查Streamlit安装
   pip install streamlit
   
   # 使用特定端口启动
   streamlit run app_250911.py --server.port 8501
   ```

### 日志查看

```bash
# 查看实时日志
streamlit run app_250911.py --logger.level=debug

# 查看应用输出
cd /Users/bytedance/Desktop/HW/通用解决方案/demo搭建实验/长视频生成
tail -f nohup.out  # 如果使用nohup启动
```

## 🚀 性能优化建议

### 硬件要求
- **内存**: 16GB+ 推荐
- **存储**: 10GB+ 可用空间
- **网络**: 稳定高速互联网连接

### 软件优化
1. **使用虚拟环境** - 避免包冲突
2. **定期清理文件** - 使用"清空所有数据"功能
3. **分批处理** - 大量场景时分批生成
4. **监控资源使用** - 注意内存和CPU使用情况

### 网络优化
1. **使用有线连接** - 更稳定的网络
2. **避免高峰时段** - 选择网络空闲时段运行
3. **配置代理** - 如有需要配置网络代理

## 📞 技术支持

### 问题反馈
如果您遇到任何问题，请检查：
1. 所有依赖是否正确安装
2. 配置文件中的API密钥是否正确
3. 网络连接是否正常
4. 系统资源是否充足

### 获取帮助
1. 查看本README文件
2. 检查应用中的错误提示信息
3. 查看生成日志文件
4. 确保ffmpeg正确安装并可调用

## 🎉 开始创作！

现在您已经完成了所有准备工作，可以：

1. **启动应用**
   ```bash
   cd /Users/bytedance/Desktop/HW/通用解决方案/demo搭建实验/长视频生成
   streamlit run app_250911.py
   ```

2. **打开浏览器**访问 http://localhost:8501

3. **按照界面指引**开始生成您的第一个长视频！

祝您创作愉快！🎬✨

---
*最后更新: 2024年1月*  
*版本: v1.0*  
*技术支持: 方舟大模型平台*